---
layout:     post
title:      学习笔记： 硬件接口详解
subtitle:   Learning Notes
date:       2020-04-26
author:     MZ
header-img: img/post-bg-Reading-cyydcx.jpg
catalog: true
tags:
    - Learning Notes

---

# 硬件接口详解

> 记录硬件工程师常用的接口知识，方便深入理解

## 串行

### 1. UART

通用异步收发传输器（Universal Asynchronous Receiver/Transmitter)，通常称作UART。

UART是个大家族，包括了RS232、RS499、RS423、RS422和RS485等接口标准规范和总线标准规范。它们的主要区别在于其各自的电平范围不相同。

嵌入式设备中常常使用到的是TTL、TTL转RS232的这种方式。常用的就三根引线：发送线TX、接收线RX、电平参考地线GND。

UART作为异步串口通信协议的一种，工作原理是将传输数据的每个字符一位一位地传输。其中，各位的意义如下：

- **起始位：**先发出一个逻辑“0”的信号，表示传输字符的开始。

- **数据位：**紧接着起始位之后。数据位的个数可以是4、5、6、7、8等，构成一个字符。通常采用ASCII码。

- **奇偶校验位：**数据位加上这一位后(数据和校验位)，使得“1”的位数应为偶数（偶校验）或奇校验（奇校验），以此来校验资料的传送正确性。**工程上利用归约异或的结果作为偶校验，奇校验则取反。**

- **停止位：**它是一个字符数据的结束标志。可以是1位、1.5位、2位的高电平。
- **空闲位：**处于逻辑“1”的状态，表示当前线路上没有资料传输。

![JcXaxs.png](https://s1.ax1x.com/2020/04/26/JcXaxs.png)



数据传输速率用波特率表示，即每秒传送的二进制位数。例如数据传输速率为120字符/秒，而每一个字符为10位（1个起始位，7个数据位，1个校验位，1个结束位），则波特率为10*120=1200

**UART抛开了clock信号，通过采样的方式进行识别，所以在数据传输的双方需要定义统一波特率，以便正确的传输数据。**

**FPGA程序设计**

对于FPGA设计，主要有三个模块组成：**波特率发生模块、发送模块，接收模块**组成。

波特率发生模块
　　设计的UART的接收和发送按照相同的波特率进行，波特率可以通过接口模块的总线接口进行设置。UART收发的每一个数据宽度都是波特率发生器输出的时钟周期的16倍，即假定当前按照9600b/s进行收发，那么波特率发生器的输出时钟频率应该为9600&TImes;16Hz。假定提供的外部时钟为1.6MHz，可以很简单地通过总线写入不同的数值到波特率发生器保持寄存器，然后用计数器的方式生成所需要的各种波特率，即分频器。计算公式为：1600000/（16&TImes;所期望的波特率）-1，如果希望输出10000Hz的波特率，可以得出从总线写入的数值为1600000/（16&TImes;10000）-1=9（09H）。

### 2. IIC总线

IIC（Inter-Integrated Circuit）。一种串行数据总线，只有两根信号线，一根是双向的数据线SDA，另一根是时钟线SCL。两条线可以挂多个设备。IIC设备（绝大多数）具有固化的地址，只有在两条线上传输的值等于IIC设备的固化地址时，其才会作出响应。通常我们为了方便把IIC设备分为主设备和从设备，基本上谁控制时钟线（即控制SCL的电平高低变换）谁就是主设备。

当没有数据传输时，两根总线均为高电平，当采集IIC上的数据时，其时钟线SCL必须是高电平且SDA的数据必须保持稳定不变——将SDA的电平与SCL的高电平进行“与”操作后，以便确定SDA上是1还是0；在SCL为低电平的时候，SDA上的数据可以进行跳变。

数据传输开始时，需要发送一个起始信号；数据传输结束后，需要发送一个终止信号；每8bit数据传输结束，都需要一个ACK。起止信号都由Master发出，而ACK则可能由Master或者SLAVE来发出。数据的传输采用大端传输。

开始信号：SCL为高电平，SDA的电平由高跳到低表示开始信号。

终止信号：SCL为高电平，SDA的电平由低跳到高表示终止信号。

![YEQYQO.png](https://s1.ax1x.com/2020/05/06/YEQYQO.png)

写寄存器的标准流程为：

1. Master发起start
2. Master发送IIC addr（7bit）和w操作0（1bit），等待ACK
3. Slave发送ACK
4. Master发送reg addr（8bit），等待ACK
5. Slave发送ACK
6. Master发送data（8bit），即要写入寄存器的数据，等待ACK
7. Slave发送ACK
8. 第6步和第7步可以重复多次，即顺序写多个寄存器
9. Master发起stop

读寄存器的标准流程为：

1. Master发送IIC addr（7bit）和w操作0（1bit），等待ACK
2. Slave发送ACK
3. Master发送reg addr（8bit），等待ACK
4. Slave发送ACK
5. Master发送start
6. Master发送IIC addr（7bit）和r操作1（1bit），等待ACK
7. Slave发送ACK
8. Slave发送data（8bit），即寄存器里的值
9. Master发送ACK
10. 第8步和第9步可以重复多次，即顺序读多个寄存器